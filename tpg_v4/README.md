TPG version using shared registers